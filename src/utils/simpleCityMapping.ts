const DEFAULT_CITY = "Ihrer Stadt";
const DEFAULT_ZIP = "00000";

// Import der NRW-Städte Daten
import nrwCityData from '../../public/geoIdToCity_vollstaendig_nrw.json';

// PLZ-Mapping für NRW-Städte (ergänze bei Bedarf)
const nrwCityPLZ: { [key: string]: string } = {
  "Aachen": "52062",
  "Düsseldorf": "40210", 
  "Köln": "50667",
  "Dortmund": "44135",
  "Essen": "45127",
  "Duisburg": "47051",
  "Bochum": "44787",
  "Oberhausen": "46045",
  "Bielefeld": "33602",
  "Herne": "44623",
  "Münster": "48143",
  "Mönchengladbach": "41061",
  "Gelsenkirchen": "45879",
  "Krefeld": "47798",
  "Hagen": "58095",
  "Hamm": "59065",
  "Mülheim an der Ruhr": "45468",
  "Wuppertal": "42103",
  "Leverkusen": "51373",
  "Bottrop": "46236",
  "Bergisch Gladbach": "51429",
  "Recklinghausen": "45657",
  "Remscheid": "42853",
  "Moers": "47441",
  "Siegen": "57072",
  "Gütersloh": "33330",
  "Schwerte": "58239",
  "Paderborn": "33098",
  "Lünen": "44532",
  "Bergkamen": "59192",
  "Dorsten": "46282",
  "Viersen": "41747",
  "Lüdenscheid": "58507",
  "Castrop-Rauxel": "44575",
  "Unna": "59423",
  "Herten": "45699",
  "Marl": "45768",
  "Lübbecke": "32312",
  "Minden": "32423",
  "Neuss": "41460",
  "Ratingen": "40878",
  "Herford": "32051",
  "Kerpen": "50171",
  "Troisdorf": "53840",
  "Hilden": "40721",
  "Velbert": "42551",
  "Witten": "58452",
  "Gladbeck": "45964",
  "Solingen": "42651",
  "Mettmann": "40822",
  "Euskirchen": "53879",
  "Bornheim": "53332",
  "Erftstadt": "50374",
  "Rheine": "48431",
  "Königswinter": "53639",
  "Bad Oeynhausen": "32545",
  "Löhne": "32584",
  "Hennef": "53773",
  "Siegburg": "53721",
  "Lohmar": "53797",
  "Sankt Augustin": "53757",
  "Bonn": "53111",
  "Mechernich": "53894",
  "Bergheim": "50126",
  "Gummersbach": "51643",
  "Erkelenz": "41812",
  "Rheinberg": "47495",
  "Kamen": "59174",
  "Wermelskirchen": "42929",
  "Schwelm": "58332",
  "Emsdetten": "48282",
  "Ahlen": "59227",
  "Steinfurt": "48565",
  "Greven": "48268",
  "Rheda-Wiedenbrück": "33378",
  "Rösrath": "51503",
  "Lengerich": "49525",
  "Vreden": "48691",
  "Werl": "59457",
  "Herzogenrath": "52134",
  "Kamp-Lintfort": "47475",
  "Beckum": "59269",
  "Lemgo": "32657",
  "Petershagen": "32469",
  "Tecklenburg": "49545",
  "Coesfeld": "48653",
  "Dülmen": "48249",
  "Warendorf": "48231",
  "Schmallenberg": "57392",
  "Warburg": "34414",
  "Espelkamp": "32339",
  "Datteln": "45711",
  "Frechen": "50226",
  "Geilenkirchen": "52511",
  "Höxter": "37671",
  "Haltern am See": "45721",
  "Haan": "42781",
  "Halver": "58553",
  "Jülich": "52428",
  "Kleve": "47533",
  "Bünde": "32257",
  "Warstein": "59581",
  "Stolberg": "52222",
  "Attendorn": "57439",
  "Waltrop": "45731",
  "Netphen": "57250",
  "Detmold": "32756",
  "Lage": "32791",
  "Versmold": "33775",
  "Overath": "51491",
  "Brilon": "59929",
  "Oelde": "59302",
  "Rees": "46459",
  "Salzkotten": "33154",
  "Hemer": "58675",
  "Meinerzhagen": "58540",
  "Geseke": "59590",
  "Menden": "58706",
  "Wesel": "46483",
  "Hückelhoven": "41836",
  "Sundern": "59846",
  "Gronau": "48599",
  "Wegberg": "41844",
  "Emmerich am Rhein": "46446",
  "Plettenberg": "58840",
  "Enger": "32130",
  "Goch": "47574",
  "Lindlar": "51789",
  "Lennestadt": "57368",
  "Soest": "59494",
  "Hamminkeln": "46499",
  "Monschau": "52156",
  "Wiehl": "51674",
  "Halle": "33790",
  "Xanten": "46509",
  "Olpe": "57462",
  "Wipperfürth": "51688",
  "Verl": "33415",
  "Rheinbach": "53359",
  "Lippstadt": "59555",
  "Kevelaer": "47623",
  "Selm": "59379",
  "Hiddenhausen": "32120",
  "Olfen": "59399",
  "Borken": "46325",
  "Schwalmtal": "41366",
  "Oer-Erkenschwick": "45739",
  "Rietberg": "33397",
  "Kreuztal": "57223",
  "Straelen": "47638",
  "Wetter": "58300",
  "Iserlohn": "58636",
  "Werne": "59368",
  "Engelskirchen": "51766",
  "Hürth": "50354",
  "Würselen": "52146",
  "Meschede": "59872",
  "Neukirchen-Vluyn": "47506",
  "Jüchen": "41363",
  "Düren": "52349",
  "Porta Westfalica": "32457",
  "Willich": "47877",
  "Delbrück": "33129",
  "Bad Salzuflen": "32105",
  "Voerde": "46562",
  "Bocholt": "46395",
  "Geldern": "47608",
  "Herdecke": "58313",
  "Wülfrath": "42489",
  "Heiligenhaus": "42579",
  "Korschenbroich": "41352",
  "Sprockhövel": "45549",
  "Niederkassel": "53859",
  "Wachtberg": "53343",
  "Alfter": "53347",
  "Much": "53804",
  "Wesseling": "50389",
  "Dormagen": "41538",
  "Swisttal": "53913",
  "Eitorf": "53783",
  "Bad Honnef": "53604",
  "Ruppichteroth": "53809",
  "Windeck": "51570",
  "Neunkirchen-Seelscheid": "53819",
  "Kürten": "51515",
  "Odenthal": "51519"
};

// Funktion zur Generierung der NRW-Mappings
function generateNRWMappings() {
  const nrwMappings: { [key: string]: { name: string; plz: string } } = {};
  
  for (const [cityName, ids] of Object.entries(nrwCityData)) {
    const plz = nrwCityPLZ[cityName] || "00000";
    
    // Füge jede ID für diese Stadt hinzu
    ids.forEach(id => {
      nrwMappings[id] = { name: cityName, plz };
    });
  }
  
  return nrwMappings;
}

// Generiere NRW-Mappings
const nrwMappings = generateNRWMappings();

// Erweiterte Mapping-Tabelle für Stadt-Erkennung
const cityMapping: { [key: string]: { name: string; plz: string } } = {
  // Direkte Stadtnamen (nur nicht-NRW Städte, um Duplikate zu vermeiden)
  "berlin": { name: "Berlin", plz: "10115" },
  "hamburg": { name: "Hamburg", plz: "20095" },
  "muenchen": { name: "München", plz: "80331" },
  "münchen": { name: "München", plz: "80331" },
  "frankfurt": { name: "Frankfurt", plz: "60311" },
  "stuttgart": { name: "Stuttgart", plz: "70173" },
  
  // Alternative Schreibweisen für NRW-Städte
  "koeln": { name: "Köln", plz: "50667" },
  "koln": { name: "Köln", plz: "50667" },
  "cologne": { name: "Köln", plz: "50667" },
  "muelheim": { name: "Mülheim an der Ruhr", plz: "45468" },
  "mülheim": { name: "Mülheim an der Ruhr", plz: "45468" },
  
  // Kammerjäger + Stadt Kombinationen für NRW
  "kammerjaeger-duisburg": { name: "Duisburg", plz: "47051" },
  "kammerjaeger-essen": { name: "Essen", plz: "45127" },
  "kammerjaeger-koeln": { name: "Köln", plz: "50667" },
  "kammerjaeger-dortmund": { name: "Dortmund", plz: "44135" },
  "kammerjaeger-oberhausen": { name: "Oberhausen", plz: "46045" },
  "kammerjaeger-bochum": { name: "Bochum", plz: "44787" },
  "kammerjaeger-herne": { name: "Herne", plz: "44623" },
  "kammerjaeger-gelsenkirchen": { name: "Gelsenkirchen", plz: "45879" },
  "kammerjäger-duisburg": { name: "Duisburg", plz: "47051" },
  "kammerjäger-essen": { name: "Essen", plz: "45127" },
  "kammerjäger-köln": { name: "Köln", plz: "50667" },
  "kammerjäger-dortmund": { name: "Dortmund", plz: "44135" },
  
  // Numerische IDs - ursprünglich (Baden-Württemberg und andere)
  "101": { name: "Köln", plz: "50667" },
  "102": { name: "Dortmund", plz: "44135" },
  "103": { name: "Duisburg", plz: "47051" },
  "104": { name: "Oberhausen", plz: "46045" },
  "1003943": { name: "Freiburg im Breisgau", plz: "79098" },
  
  // Baden-Württemberg Städte mit numerischen IDs
  "1004054": { name: "Stuttgart", plz: "70173" },
  "9060723": { name: "Stuttgart-Mitte", plz: "70173" },
  "9191811": { name: "Stuttgart-Weilimdorf", plz: "70439" },
  "9194087": { name: "Stuttgart-Süd", plz: "70180" },
  "9194867": { name: "Stuttgart-Ost", plz: "70186" },
  "9195138": { name: "Stuttgart-West", plz: "70176" },
  "9195323": { name: "Stuttgart-Weilimdorf", plz: "70439" },
  "9041669": { name: "Albbruck", plz: "79774" },
  "9041670": { name: "Wehr", plz: "79664" },
  "9041671": { name: "Bad Säckingen", plz: "79713" },
  "9041672": { name: "Schopfheim", plz: "79650" },
  "9041673": { name: "Waldshut-Tiengen", plz: "79761" },
  "9041674": { name: "Stühlingen", plz: "79780" },
  "9041675": { name: "Wutöschingen", plz: "79793" },
  "9041676": { name: "Klettgau", plz: "79790" },
  "9041677": { name: "Lauchringen", plz: "79787" },
  "9041678": { name: "Küssaberg", plz: "79790" },
  "9041679": { name: "Hohentengen am Hochrhein", plz: "79801" },
  "9041680": { name: "Jestetten", plz: "79798" },
  "9041681": { name: "Tengen", plz: "78250" },
  "9041682": { name: "Geisingen", plz: "78187" },
  "9041683": { name: "Blumberg", plz: "78176" },
  "9041684": { name: "Donaueschingen", plz: "78166" },
  "9041685": { name: "Villingen-Schwenningen", plz: "78050" },
  "9041686": { name: "Villingen-Schwenningen", plz: "78052" },
  "9041687": { name: "Villingen-Schwenningen", plz: "78054" },
  "9041688": { name: "Villingen-Schwenningen", plz: "78056" },
  "9041689": { name: "Trossingen", plz: "78647" },
  "9041690": { name: "Bad Dürrheim", plz: "78073" },
  "9041691": { name: "Spaichingen", plz: "78549" },
  "9041692": { name: "Aldingen", plz: "78554" },
  "9041693": { name: "Deißlingen", plz: "78652" },
  "9041694": { name: "Rottweil", plz: "78628" },
  "9041695": { name: "Dotternhausen", plz: "72281" },
  "9041696": { name: "Haigerloch", plz: "72401" },
  "9041697": { name: "Rosenfeld", plz: "72348" },
  "9041698": { name: "Oberndorf am Neckar", plz: "78727" },
  "9041699": { name: "Sulz am Neckar", plz: "72172" },
  "9041700": { name: "Dornhan", plz: "72175" },
  "9041701": { name: "Schramberg", plz: "78713" },
  "9041702": { name: "Niedereschach", plz: "78078" },
  "9041703": { name: "Dauchingen", plz: "78083" },
  "9041704": { name: "St. Georgen", plz: "78112" },
  "9041705": { name: "Schiltach", plz: "77761" },
  "9041706": { name: "Alpirsbach", plz: "72275" },
  "9041707": { name: "Loßburg", plz: "72290" },
  "9041708": { name: "Wolfach", plz: "77709" },
  "9041709": { name: "Zell am Harmersbach", plz: "77736" },
  "9041710": { name: "Haslach", plz: "77716" },
  "9041711": { name: "Furtwangen im Schwarzwald", plz: "78120" },
  "9041712": { name: "Lenzkirch", plz: "79853" },
  "9041713": { name: "Titisee-Neustadt", plz: "79822" },
  "9041714": { name: "Kirchzarten", plz: "79199" },
  "9041715": { name: "Freiburg im Breisgau", plz: "79098" },
  "9041716": { name: "Freiburg im Breisgau", plz: "79100" },
  "9041717": { name: "Ehrenkirchen", plz: "79238" },
  "9041718": { name: "Staufen im Breisgau", plz: "79219" },
  "9041719": { name: "Hartheim", plz: "79258" },
  "9041720": { name: "Bad Krozingen", plz: "79189" },
  "9041721": { name: "Freiburg im Breisgau", plz: "79102" },
  "9041722": { name: "Breisach am Rhein", plz: "79206" },
  "9041723": { name: "Endingen am Kaiserstuhl", plz: "79346" },
  "9041724": { name: "Bötzingen", plz: "79268" },
  "9041725": { name: "Teningen", plz: "79331" },
  "9041726": { name: "Emmendingen", plz: "79312" },
  "9041727": { name: "Freiburg im Breisgau", plz: "79104" },
  "9041728": { name: "Freiburg im Breisgau", plz: "79106" },
  "9041729": { name: "Freiburg im Breisgau", plz: "79108" },
  "9041730": { name: "Freiburg im Breisgau", plz: "79110" },
  "9041731": { name: "Freiburg im Breisgau", plz: "79112" },
  "9041732": { name: "Freiburg im Breisgau", plz: "79114" },
  "9041733": { name: "Denzlingen", plz: "79211" },
  "9041734": { name: "Waldkirch", plz: "79183" },
  "9041735": { name: "Kenzingen", plz: "79341" },
  "9041736": { name: "Herbolzheim", plz: "79336" },
  "9041737": { name: "Ettenheim", plz: "77955" },
  "9041738": { name: "Gengenbach", plz: "77723" },
  "9041739": { name: "Friesenheim", plz: "77948" },
  "9041740": { name: "Lahr/Schwarzwald", plz: "77933" },
  "9041741": { name: "Schwanau", plz: "77963" },
  "9041742": { name: "Rust", plz: "77977" },
  "9041743": { name: "Neuenburg am Rhein", plz: "79395" },
  "9041744": { name: "Kandern", plz: "79400" },
  "9041745": { name: "Müllheim", plz: "79379" },
  "9041746": { name: "Wittlingen", plz: "79297" },
  "9041747": { name: "Lörrach", plz: "79539" },
  "9041748": { name: "Lörrach", plz: "79541" },
  "9041749": { name: "Maulburg", plz: "79689" },
  "9041750": { name: "Rheinfelden", plz: "79618" },
  "9041751": { name: "Grenzach-Wyhlen", plz: "79639" },
  "9041752": { name: "Weil am Rhein", plz: "79576" },
  "9041753": { name: "Efringen-Kirchen", plz: "79588" },
  "9041852": { name: "Rheinau", plz: "77866" },
  "9041853": { name: "Willstätt", plz: "77731" },
  "9041854": { name: "Kehl", plz: "77694" },
  "9041855": { name: "Appenweier", plz: "77767" },
  "9041856": { name: "Schutterwald", plz: "77746" },
  "9041857": { name: "Offenburg", plz: "77652" },
  "9041858": { name: "Offenburg", plz: "77654" },
  "9041859": { name: "Offenburg", plz: "77656" },
  "9041860": { name: "Oberkirch", plz: "77704" },
  "9041861": { name: "Achern", plz: "77855" },
  "9041862": { name: "Renchen", plz: "77871" },
  "9041863": { name: "Rheinmünster", plz: "77836" },
  "9041864": { name: "Iffezheim", plz: "76473" },
  "9041865": { name: "Rastatt", plz: "76437" },
  "9041867": { name: "Karlsruhe", plz: "76131" },
  "9041868": { name: "Karlsruhe", plz: "76133" },
  "9041869": { name: "Durmersheim", plz: "76448" },
  "9041870": { name: "Rheinstetten", plz: "76287" },
  "9041871": { name: "Ettlingen", plz: "76275" },
  "9041872": { name: "Karlsruhe", plz: "76135" },
  "9041873": { name: "Karlsruhe", plz: "76137" },
  "9041874": { name: "Karlsruhe", plz: "76139" },
  "9041875": { name: "Karlsruhe", plz: "76185" },
  "9041876": { name: "Karlsruhe", plz: "76187" },
  "9041877": { name: "Karlsruhe", plz: "76189" },
  "9041878": { name: "Karlsruhe", plz: "76227" },
  "9041879": { name: "Walzbachtal", plz: "76337" },
  "9041880": { name: "Pfinztal", plz: "76327" },
  "9041881": { name: "Remchingen", plz: "75196" },
  "9041882": { name: "Keltern", plz: "75210" },
  "9041883": { name: "Karlsbad", plz: "76307" },
  "9041884": { name: "Waldbronn", plz: "76337" },
  "9041885": { name: "Karlsruhe", plz: "76229" },
  "9041886": { name: "Straubenhardt", plz: "75334" },
  "9041887": { name: "Gaggenau", plz: "76571" },
  "9041888": { name: "Malsch", plz: "76316" },
  "9041889": { name: "Baden-Baden", plz: "76530" },
  "9041890": { name: "Baden-Baden", plz: "76532" },
  "9041891": { name: "Bühl", plz: "77815" },
  "9041892": { name: "Baden-Baden", plz: "76534" },
  "9041893": { name: "Ottersweier", plz: "77833" },
  "9041894": { name: "Sasbachwalden", plz: "77887" },
  "9041895": { name: "Baiersbronn", plz: "72270" },
  "9041896": { name: "Freudenstadt", plz: "72250" },
  "9041897": { name: "Gernsbach", plz: "76593" },
  "9041898": { name: "Bad Wildbad", plz: "75323" },
  "9041899": { name: "Calw", plz: "75365" },
  "9041900": { name: "Wildberg", plz: "72218" },
  "9041901": { name: "Neubulach", plz: "75387" },
  "9041902": { name: "Altensteig", plz: "72213" },
  "9041903": { name: "Pfalzgrafenweiler", plz: "72285" },
  "9041904": { name: "Waldachtal", plz: "72178" },
  "9041905": { name: "Dornstetten", plz: "72280" },
  "9041906": { name: "Schopfloch", plz: "72294" },
  "9041907": { name: "Horb am Neckar", plz: "72160" },
  "9041908": { name: "Nagold", plz: "72202" },
  "9041909": { name: "Eutingen im Gäu", plz: "72184" },
  "9041910": { name: "Empfingen", plz: "72186" },
  "9041911": { name: "Bondorf", plz: "71149" },
  "9041912": { name: "Herrenberg", plz: "71083" },
  "9041913": { name: "Gäufelden", plz: "71126" },
  "9041914": { name: "Aidlingen", plz: "71134" },
  "9041915": { name: "Nufringen", plz: "71154" },
  "9041916": { name: "Gärtringen", plz: "71116" },
  "9041917": { name: "Renningen", plz: "71272" },
  "9041918": { name: "Weissach", plz: "71287" },
  "9041919": { name: "Rutesheim", plz: "71277" },
  "9041920": { name: "Heimsheim", plz: "71296" },
  "9041921": { name: "Weil der Stadt", plz: "71263" },
  "9041922": { name: "Althengstett", plz: "75382" },
  "9041923": { name: "Bad Liebenzell", plz: "75378" },
  "9041924": { name: "Schömberg", plz: "75328" },
  "9041925": { name: "Birkenfeld", plz: "75217" },
  "9041926": { name: "Neuhausen", plz: "75196" },
  "9041927": { name: "Niefern-Öschelbronn", plz: "75223" },
  "9041928": { name: "Pforzheim", plz: "75172" },
  "9041929": { name: "Pforzheim", plz: "75174" },
  "9041930": { name: "Pforzheim", plz: "75175" },
  "9041931": { name: "Pforzheim", plz: "75177" },
  "9041932": { name: "Pforzheim", plz: "75179" },
  "9041933": { name: "Ispringen", plz: "75228" },
  "9041934": { name: "Königsbach-Stein", plz: "75203" },
  "9041935": { name: "Knittlingen", plz: "75438" },
  "9041936": { name: "Mühlacker", plz: "75417" },
  "9041937": { name: "Wiernsheim", plz: "75446" },
  "9041938": { name: "Eberdingen", plz: "71735" },
  "9041939": { name: "Vaihingen an der Enz", plz: "71665" },
  "9041940": { name: "Sachsenheim", plz: "74343" },
  "9041941": { name: "Brackenheim", plz: "74336" },
  "9041942": { name: "Güglingen", plz: "74363" },
  "9041943": { name: "Eppingen", plz: "75031" },
  "9041944": { name: "Gemmingen", plz: "75050" },
  "9041945": { name: "Schwaigern", plz: "74193" },
  "9041946": { name: "Massenbachhausen", plz: "74243" },
  "9041947": { name: "Bad Rappenau", plz: "74906" },
  "9041948": { name: "Sinsheim", plz: "74889" },
  "9041949": { name: "Meckesheim", plz: "74909" },
  "9041950": { name: "Dielheim", plz: "69234" },
  "9041951": { name: "Mühlhausen", plz: "69242" },
  "9041952": { name: "Angelbachtal", plz: "74918" },
  "9041953": { name: "Kraichtal", plz: "76703" },
  "9041954": { name: "Östringen", plz: "76684" },
  "9041955": { name: "Oberderdingen", plz: "75038" },
  "9041956": { name: "Bretten", plz: "75015" },
  "9041957": { name: "Ubstadt-Weiher", plz: "76698" },
  "9041958": { name: "Bruchsal", plz: "76646" },
  "9041959": { name: "Karlsdorf-Neuthard", plz: "76689" },
  "9041960": { name: "Weingarten", plz: "76356" },
  "9041961": { name: "Stutensee", plz: "76297" },
  "9041962": { name: "Linkenheim-Hochstetten", plz: "76351" },
  "9041963": { name: "Eggenstein-Leopoldshafen", plz: "76344" },
  "9041967": { name: "Dettenheim", plz: "76706" },
  "9041968": { name: "Graben-Neudorf", plz: "76676" },
  "9041969": { name: "Oberhausen-Rheinhausen", plz: "76784" },
  "9041971": { name: "Philippsburg", plz: "76661" },
  "9041974": { name: "Hockenheim", plz: "68766" },
  "9041975": { name: "Ketsch", plz: "68775" },
  "9041976": { name: "Sandhausen", plz: "69207" },
  "9041977": { name: "Reilingen", plz: "68799" },
  "9041978": { name: "Waghäusel", plz: "68753" },
  "9041979": { name: "Sankt Leon-Rot", plz: "68789" },
  "9041980": { name: "Kronau", plz: "76709" },
  "9041981": { name: "Bad Schönborn", plz: "76669" },
  "9041982": { name: "Wiesloch", plz: "69168" },
  "9041983": { name: "Walldorf", plz: "69190" },
  "9041984": { name: "Leimen", plz: "69181" },
  "9041985": { name: "Nußloch", plz: "69226" },
  "9041986": { name: "Heidelberg", plz: "69115" },
  "9041987": { name: "Heidelberg", plz: "69117" },
  "9041988": { name: "Heidelberg", plz: "69118" },
  "9041989": { name: "Heidelberg", plz: "69120" },
  "9041990": { name: "Heidelberg", plz: "69121" },
  "9041991": { name: "Heidelberg", plz: "69123" },
  "9041992": { name: "Schriesheim", plz: "69198" },
  "9041993": { name: "Heddesheim", plz: "68542" },
  "9041994": { name: "Ladenburg", plz: "68526" },
  "9041995": { name: "Mannheim", plz: "68159" },
  "9041996": { name: "Heidelberg", plz: "69124" },
  "9041997": { name: "Eppelheim", plz: "69214" },
  "9041998": { name: "Heidelberg", plz: "69126" },
  "9041999": { name: "Schwetzingen", plz: "68723" },
  "9042000": { name: "Brühl", plz: "68782" },
  "9042001": { name: "Edingen-Neckarhausen", plz: "68535" },
  "9042002": { name: "Mannheim", plz: "68161" },
  "9042003": { name: "Mannheim", plz: "68163" },
  "9042007": { name: "Mannheim", plz: "68165" },
  "9042012": { name: "Mannheim", plz: "68167" },
  "9042013": { name: "Mannheim", plz: "68169" },
  "9042014": { name: "Mannheim", plz: "68219" },
  "9042015": { name: "Mannheim", plz: "68229" },
  "9042016": { name: "Mannheim", plz: "68259" },
  "9042017": { name: "Mannheim", plz: "68309" },
  "9042019": { name: "Mannheim", plz: "68199" },
  "9042024": { name: "Weinheim", plz: "69469" },
  "9042027": { name: "Neckargemünd", plz: "69151" },
  "9042028": { name: "Eberbach", plz: "69412" },
  "9042029": { name: "Mosbach", plz: "74821" },
  "9042030": { name: "Buchen", plz: "74722" },
  "9042031": { name: "Walldürn", plz: "74731" },
  "9042032": { name: "Hardheim", plz: "74736" },
  "9042033": { name: "Osterburken", plz: "74706" },
  "9042034": { name: "Ravenstein", plz: "74692" },
  "9042035": { name: "Schöntal", plz: "74214" },
  "9042036": { name: "Möckmühl", plz: "74219" },
  "9042037": { name: "Elztal", plz: "74834" },
  "9042038": { name: "Billigheim", plz: "74842" },
  "9042039": { name: "Gundelsheim", plz: "74831" },
  "9042040": { name: "Neudenau", plz: "74861" },
  "9042041": { name: "Neuenstadt am Kocher", plz: "74196" },
  "9042042": { name: "Heilbronn", plz: "74072" },
  "9042043": { name: "Neckarsulm", plz: "74172" },
  "9042044": { name: "Bad Friedrichshall", plz: "74177" },
  "9042045": { name: "Bad Wimpfen", plz: "74206" },
  "9042046": { name: "Heilbronn", plz: "74074" },
  "9042047": { name: "Leingarten", plz: "74211" },
  "9042048": { name: "Heilbronn", plz: "74076" },
  "9042049": { name: "Bönnigheim", plz: "74357" },
  "9042050": { name: "Besigheim", plz: "74354" },
  "9042051": { name: "Ilsfeld", plz: "74360" },
  "9042052": { name: "Lauffen am Neckar", plz: "74348" },
  "9042053": { name: "Heilbronn", plz: "74078" },
  "9042054": { name: "Heilbronn", plz: "74080" },
  "9042055": { name: "Heilbronn", plz: "74081" },
  "9042056": { name: "Obersulm", plz: "74182" },
  "9042057": { name: "Untergruppenbach", plz: "74199" },
  "9042058": { name: "Oberstenfeld", plz: "71720" },
  "9042059": { name: "Wüstenrot", plz: "71543" },
  "9042060": { name: "Öhringen", plz: "74613" },
  "9042061": { name: "Bretzfeld", plz: "74626" },
  "9042062": { name: "Weinsberg", plz: "74189" },
  "9042063": { name: "Kupferzell", plz: "74635" },
  "9042064": { name: "Waldenburg", plz: "74638" },
  "9042065": { name: "Murrhardt", plz: "71540" },
  "9042066": { name: "Schwäbisch Hall", plz: "74523" },
  "9042067": { name: "Gaildorf", plz: "74405" },
  "9042068": { name: "Ilshofen", plz: "74532" },
  "9042069": { name: "Wolpertshausen", plz: "74549" },
  "9042070": { name: "Gerabronn", plz: "74582" },
  "9042071": { name: "Blaufelden", plz: "74572" },
  "9042072": { name: "Schrozberg", plz: "74575" },
  "9042073": { name: "Künzelsau", plz: "74653" },
  "9042074": { name: "Assamstadt", plz: "97959" },
  "9042075": { name: "Bad Mergentheim", plz: "97980" },
  "9042076": { name: "Lauda-Königshofen", plz: "97922" },
  "9042077": { name: "Igersheim", plz: "97999" },
  "9042078": { name: "Weikersheim", plz: "97990" },
  "9042093": { name: "Ellwangen", plz: "73479" },
  "9042096": { name: "Crailsheim", plz: "74564" },
  "9042097": { name: "Satteldorf", plz: "74589" },
  "9042098": { name: "Heubach", plz: "73540" },
  "9042099": { name: "Waldstetten", plz: "73550" },
  "9042100": { name: "Schwäbisch Gmünd", plz: "73525" },
  "9042101": { name: "Donzdorf", plz: "73072" },
  "9042102": { name: "Königsbronn", plz: "89551" },
  "9042103": { name: "Steinheim am Albuch", plz: "89555" },
  "9042104": { name: "Gerstetten", plz: "89547" },
  "9042105": { name: "Herbrechtingen", plz: "89542" },
  "9042106": { name: "Heidenheim an der Brenz", plz: "89518" },
  "9042107": { name: "Oberkochen", plz: "73447" },
  "9042108": { name: "Essingen", plz: "73457" },
  "9042109": { name: "Aalen", plz: "73430" },
  "9042110": { name: "Aalen", plz: "73432" },
  "9042111": { name: "Aalen", plz: "73434" },
  "9042112": { name: "Westhausen", plz: "73463" },
  "9042113": { name: "Lauchheim", plz: "73466" },
  "9042114": { name: "Bopfingen", plz: "73441" },
  "9042115": { name: "Neresheim", plz: "73450" },
  "9042121": { name: "Dischingen", plz: "89561" },
  "9042122": { name: "Heidenheim an der Brenz", plz: "89520" },
  "9042123": { name: "Giengen an der Brenz", plz: "89537" },
  "9042126": { name: "Sontheim an der Brenz", plz: "89567" },
  "9042136": { name: "Erbach", plz: "89155" },
  "9042137": { name: "Ulm", plz: "89073" },
  "9042138": { name: "Ulm", plz: "89075" },
  "9042139": { name: "Ulm", plz: "89077" },
  "9042140": { name: "Ulm", plz: "89079" },
  "9042141": { name: "Ulm", plz: "89081" },
  "9042145": { name: "Langenau", plz: "89129" },
  "9042146": { name: "Dornstadt", plz: "89160" },
  "9042147": { name: "Geislingen an der Steige", plz: "73312" },
  "9042148": { name: "Blaubeuren", plz: "89143" },
  "9042149": { name: "Münsingen", plz: "72525" },
  "9042150": { name: "Bad Urach", plz: "72574" },
  "9042151": { name: "Dettingen an der Erms", plz: "72581" },
  "9042152": { name: "Nürtingen", plz: "72622" },
  "9042153": { name: "Kirchheim unter Teck", plz: "73230" },
  "9042154": { name: "Weilheim an der Teck", plz: "73235" },
  "9042155": { name: "Laichingen", plz: "89150" },
  "9042156": { name: "Süßen", plz: "73079" },
  "9042157": { name: "Salach", plz: "73084" },
  "9042158": { name: "Eislingen", plz: "73054" },
  "9042159": { name: "Zell unter Aichelberg", plz: "73119" },
  "9042160": { name: "Göppingen", plz: "73033" },
  "9042161": { name: "Göppingen", plz: "73035" },
  "9042162": { name: "Göppingen", plz: "73037" },
  "9042163": { name: "Schwäbisch Gmünd", plz: "73527" },
  "9042164": { name: "Alfdorf", plz: "73553" },
  "9042165": { name: "Lorch", plz: "73547" },
  "9042166": { name: "Plüderhausen", plz: "71131" },
  "9042167": { name: "Urbach", plz: "71711" },
  "9042168": { name: "Rudersberg", plz: "73635" },
  "9042169": { name: "Welzheim", plz: "73642" },
  "9042170": { name: "Remshalden", plz: "73630" },
  "9042171": { name: "Baltmannsweiler", plz: "73666" },
  "9042172": { name: "Schorndorf", plz: "73614" },
  "9042173": { name: "Ebersbach an der Fils", plz: "73061" },
  "9042174": { name: "Uhingen", plz: "73066" },
  "9042175": { name: "Schlierbach", plz: "73114" },
  "9042176": { name: "Wernau", plz: "73249" },
  "9042177": { name: "Reichenbach an der Fils", plz: "73262" },
  "9042178": { name: "Plochingen", plz: "73207" },
  "9042179": { name: "Wendlingen am Neckar", plz: "73240" },
  "9042180": { name: "Denkendorf", plz: "73770" },
  "9042181": { name: "Köngen", plz: "73257" },
  "9042182": { name: "Esslingen am Neckar", plz: "73728" },
  "9042183": { name: "Esslingen am Neckar", plz: "73730" },
  "9042184": { name: "Esslingen am Neckar", plz: "73732" },
  "9042185": { name: "Neuhausen auf den Fildern", plz: "73765" },
  "9042186": { name: "Stuttgart", plz: "70174" },
  "9042187": { name: "Ostfildern", plz: "73760" },
  "9042188": { name: "Stuttgart", plz: "70178" },
  
  // Hamburg Städte mit numerischen IDs
  "1004437": { name: "Hamburg", plz: "20095" },
  "9048859": { name: "Wentorf bei Hamburg", plz: "21465" },
  "9060686": { name: "Hamburg-Altstadt", plz: "20095" },
  "9060687": { name: "Hamburg-Neustadt", plz: "20354" },
  "9061053": { name: "Hamburg-Mitte", plz: "20095" },
  "9061054": { name: "Hamburg-Altona", plz: "22765" },
  "9061055": { name: "Hamburg-Eimsbüttel", plz: "20259" },
  "9061056": { name: "Hamburg-Nord", plz: "22299" },
  "9061057": { name: "Hamburg-Wandsbek", plz: "22041" },
  "9061058": { name: "Hamburg-Bergedorf", plz: "21029" },
  "9061059": { name: "Hamburg-Harburg", plz: "21073" },
  "9072449": { name: "Hamburg-Speicherstadt", plz: "20457" },
  "9189751": { name: "Hamburg-Winterhude", plz: "22299" },
  "9190458": { name: "Hamburg-Blankenese", plz: "22587" },
  "9191127": { name: "Hamburg-Lokstedt", plz: "22529" },
  "9192120": { name: "Hamburg-Finkenwerder", plz: "21129" },
  "9193092": { name: "Hamburg-Bergedorf", plz: "21029" },
  "9193469": { name: "Hamburg-Rissen", plz: "22559" },
  "9195342": { name: "Hamburg-Eimsbüttel", plz: "20259" },
  "9195942": { name: "Hamburg-Meiendorf", plz: "22145" },
  "9207687": { name: "Hamburg-Steinwerder", plz: "21107" },
  "9208010": { name: "Hamburg-Lemsahl-Mellingstedt", plz: "22397" },
  "9208036": { name: "Hamburg-Billbrook", plz: "22113" },
  "9210262": { name: "Hamburg-Kleiner Grasbrook", plz: "20457" },
  "9211512": { name: "Hamburg-Rothenburgsort", plz: "20539" },
  "9211766": { name: "Hamburg-Duvenstedt", plz: "22397" },
  "9213151": { name: "Hamburg-Hamm", plz: "20537" },
  "9214330": { name: "Hamburg-Rahlstedt", plz: "22143" },
  "9215146": { name: "Hamburg-Lohbrügge", plz: "21031" },
  "9215749": { name: "Hamburg-Farmsen-Berne", plz: "22159" },
  "9217626": { name: "Hamburg-Moorfleet", plz: "20539" },
  "9218954": { name: "Hamburg-Marmstorf", plz: "21077" },
  "9219698": { name: "Hamburg-Steilshoop", plz: "22309" },
  "9219923": { name: "Hamburg-Veddel", plz: "20539" },
  "9220214": { name: "Hamburg-Neuland", plz: "21079" },
  "9220604": { name: "Hamburg-Bergstedt", plz: "22395" },
  "9220938": { name: "Hamburg-Waltershof", plz: "21129" },
  
  // Weitere Hamburg IDs - alle zeigen auf Hamburg
  "9043424": { name: "Hamburg", plz: "20095" },
  "9043438": { name: "Hamburg", plz: "20095" },
  "9043439": { name: "Hamburg", plz: "20095" },
  "9043440": { name: "Hamburg", plz: "20095" },
  "9043441": { name: "Hamburg", plz: "20095" },
  "9043442": { name: "Hamburg", plz: "20095" },
  "9043443": { name: "Hamburg", plz: "20095" },
  "9043444": { name: "Hamburg", plz: "20095" },
  "9043445": { name: "Hamburg", plz: "20095" },
  "9043446": { name: "Hamburg", plz: "20095" },
  "9043447": { name: "Hamburg", plz: "20095" },
  "9043448": { name: "Hamburg", plz: "20095" },
  "9043449": { name: "Hamburg", plz: "20095" },
  "9043450": { name: "Hamburg", plz: "20095" },
  "9043451": { name: "Hamburg", plz: "20095" },
  "9043453": { name: "Hamburg", plz: "20095" },
  "9043454": { name: "Hamburg", plz: "20095" },
  "9043455": { name: "Hamburg", plz: "20095" },
  "9043456": { name: "Hamburg", plz: "20095" },
  "9043457": { name: "Hamburg", plz: "20095" },
  "9043458": { name: "Hamburg", plz: "20095" },
  "9043459": { name: "Hamburg", plz: "20095" },
  "9043460": { name: "Hamburg", plz: "20095" },
  "9043461": { name: "Hamburg", plz: "20095" },
  "9043462": { name: "Hamburg", plz: "20095" },
  "9043463": { name: "Hamburg", plz: "20095" },
  "9043464": { name: "Hamburg", plz: "20095" },
  "9043465": { name: "Hamburg", plz: "20095" },
  "9043466": { name: "Hamburg", plz: "20095" },
  "9043468": { name: "Hamburg", plz: "20095" },
  "9043469": { name: "Hamburg", plz: "20095" },
  "9043470": { name: "Hamburg", plz: "20095" },
  "9043471": { name: "Hamburg", plz: "20095" },
  "9043472": { name: "Hamburg", plz: "20095" },
  "9043473": { name: "Hamburg", plz: "20095" },
  "9043474": { name: "Hamburg", plz: "20095" },
  "9043475": { name: "Hamburg", plz: "20095" },
  "9043476": { name: "Hamburg", plz: "20095" },
  "9043477": { name: "Hamburg", plz: "20095" },
  "9043479": { name: "Hamburg", plz: "20095" },
  "9043480": { name: "Hamburg", plz: "20095" },
  "9043481": { name: "Hamburg", plz: "20095" },
  "9043482": { name: "Hamburg", plz: "20095" },
  "9043483": { name: "Hamburg", plz: "20095" },
  "9043484": { name: "Hamburg", plz: "20095" },
  "9043485": { name: "Hamburg", plz: "20095" },
  "9043486": { name: "Hamburg", plz: "20095" },
  "9043487": { name: "Hamburg", plz: "20095" },
  "9043488": { name: "Hamburg", plz: "20095" },
  "9043489": { name: "Hamburg", plz: "20095" },
  "9043490": { name: "Hamburg", plz: "20095" },
  "9043491": { name: "Hamburg", plz: "20095" },
  "9043492": { name: "Hamburg", plz: "20095" },
  "9043493": { name: "Hamburg", plz: "20095" },
  "9043494": { name: "Hamburg", plz: "20095" },
  "9043495": { name: "Hamburg", plz: "20095" },
  "9043496": { name: "Hamburg", plz: "20095" },
  "9043497": { name: "Hamburg", plz: "20095" },
  "9043498": { name: "Hamburg", plz: "20095" },
  "9043499": { name: "Hamburg", plz: "20095" },
  "9043500": { name: "Hamburg", plz: "20095" },
  "9043506": { name: "Hamburg", plz: "20095" },
  "9043507": { name: "Hamburg", plz: "20095" },
  "9043527": { name: "Hamburg", plz: "20095" },
  "9043529": { name: "Hamburg", plz: "20095" },
  "9043553": { name: "Hamburg", plz: "20095" },
  "9043554": { name: "Hamburg", plz: "20095" },
  "9043555": { name: "Hamburg", plz: "20095" },
  "9043558": { name: "Hamburg", plz: "20095" },
  "9043559": { name: "Hamburg", plz: "20095" },
  "9043562": { name: "Hamburg", plz: "20095" },
  "9068125": { name: "Hamburg", plz: "20095" },
  "9068132": { name: "Hamburg", plz: "20095" },
  "9068140": { name: "Hamburg", plz: "20095" },
  "9068144": { name: "Hamburg", plz: "20095" },
  "9068148": { name: "Hamburg", plz: "20095" },
  "9068174": { name: "Hamburg", plz: "20095" },
  "9068177": { name: "Hamburg", plz: "20095" },
  "9068185": { name: "Hamburg", plz: "20095" },
  "9068269": { name: "Hamburg", plz: "20095" },
  "9068270": { name: "Hamburg", plz: "20095" },
  "9068284": { name: "Hamburg", plz: "20095" },
  "9068311": { name: "Hamburg", plz: "20095" },
  "9068328": { name: "Hamburg", plz: "20095" },
  "9068351": { name: "Hamburg", plz: "20095" },
  "9068364": { name: "Hamburg", plz: "20095" },
  "9068526": { name: "Hamburg", plz: "20095" },
  "9068548": { name: "Hamburg", plz: "20095" },
  "9116618": { name: "Hamburg", plz: "20095" },
  "9197413": { name: "Hamburg", plz: "20095" },
  
  // Alle NRW-Städte und IDs aus der vollständigen Datei
  ...nrwMappings,
};

export function getCityFromParams() {
  const urlParams = new URLSearchParams(window.location.search);
  const kw = urlParams.get("kw")?.toLowerCase()?.trim();
  const loc = urlParams.get("loc_physical_ms");
  const cityId = urlParams.get("city_id");

  console.log("🔍 Stadt-Parameter:", { 
    kw: kw || "nicht vorhanden", 
    loc: loc || "nicht vorhanden", 
    cityId: cityId || "nicht vorhanden",
    allParams: Object.fromEntries(urlParams.entries())
  });

  // Funktion zum Extrahieren der Stadt aus kw-Parameter
  function extractCityFromKeyword(keyword: string) {
    // Entferne häufige Präfixe/Suffixe
    const cleanKeyword = keyword
      .replace(/^(kammerjäger|kammerjaeger)[-\s]+/i, '')
      .replace(/[-\s]+(kammerjäger|kammerjaeger)$/i, '')
      .toLowerCase()
      .trim();
    
    // Prüfe direkte Übereinstimmung
    if (cityMapping[cleanKeyword]) {
      return cityMapping[cleanKeyword];
    }
    
    // Prüfe ursprünglichen Keyword
    if (cityMapping[keyword]) {
      return cityMapping[keyword];
    }
    
    // Suche nach Teilübereinstimmungen
    for (const [key, value] of Object.entries(cityMapping)) {
      if (key.includes(cleanKeyword) || cleanKeyword.includes(key)) {
        return value;
      }
    }
    
    return null;
  }

  // Versuche zuerst kw (keyword) - häufigster Fall
  if (kw) {
    const cityFromKw = extractCityFromKeyword(kw);
    if (cityFromKw) {
      console.log("✅ Stadt über 'kw' gefunden:", cityFromKw);
      return cityFromKw;
    }
  }

  // Dann loc_physical_ms
  if (loc && cityMapping[loc]) {
    console.log("✅ Stadt über 'loc_physical_ms' gefunden:", cityMapping[loc]);
    return cityMapping[loc];
  }

  // Dann city_id
  if (cityId && cityMapping[cityId]) {
    console.log("✅ Stadt über 'city_id' gefunden:", cityMapping[cityId]);
    return cityMapping[cityId];
  }

  console.log("❌ Keine Stadt gefunden, verwende Standard:", { name: DEFAULT_CITY, plz: DEFAULT_ZIP });
  return { name: DEFAULT_CITY, plz: DEFAULT_ZIP };
}

export function updateDynamicCityTags(city: { name: string; plz: string }) {
  console.log("🔄 Aktualisiere DOM-Elemente mit Stadt:", city);
  
  // Aktualisiere [data-city] Elemente  
  document.querySelectorAll("[data-city]").forEach(el => {
    console.log("Aktualisiere data-city Element:", el.textContent, "->", city.name);
    el.textContent = city.name;
  });

  // Aktualisiere [data-city-pre] Elemente (für "aus Stadt")
  document.querySelectorAll("[data-city-pre]").forEach(el => {
    console.log("Aktualisiere data-city-pre Element:", el.textContent, "->", `aus ${city.name}`);
    el.textContent = `aus ${city.name}`;
  });

  // Aktualisiere [data-zip] Elemente
  document.querySelectorAll("[data-zip]").forEach(el => {
    console.log("Aktualisiere data-zip Element:", el.textContent, "->", city.plz);
    el.textContent = city.plz;
  });
  
  // Aktualisiere auch .city-welcome Klassen (für Kompatibilität)
  document.querySelectorAll(".city-welcome").forEach(el => {
    console.log("Aktualisiere city-welcome Element:", el.textContent, "->", city.name);
    el.textContent = city.name;
  });
}

export { DEFAULT_CITY, DEFAULT_ZIP };